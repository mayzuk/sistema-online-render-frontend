import React, { useEffect, useState } from 'react'
import AdminLayout from './AdminLayout'
import { api } from '../../services/api'


export default function UsersAdmin(){
const [users, setUsers] = useState([])
const [cities, setCities] = useState([])
const [loading, setLoading] = useState(true)


useEffect(()=>{
async function load(){
try{
setLoading(true)
const [u,c] = await Promise.all([api.get('/api/admin/users'), api.get('/api/admin/cities')])
setUsers(u.data)
setCities(c.data)
}catch(err){ console.error(err) }finally{ setLoading(false) }
}
load()
},[])


async function save(u){
try{
await api.put('/api/admin/users/'+u.id, {
name: u.name,
email: u.email,
is_admin: u.is_admin,
city_id: u.city_id
})
alert('Salvo')
}catch(err){ console.error(err); alert('Erro ao salvar') }
}


if(loading) return <p>Carregando usuários...</p>


return (
<AdminLayout title="Usuários">
<div className="space-y-3">
{users.map(user=> (
<div key={user.id} className="bg-white p-4 rounded-lg shadow flex flex-col md:flex-row md:items-center md:justify-between gap-3">
<div>
<div className="font-semibold">{user.name}</div>
<div className="text-sm text-slate-500">{user.email}</div>
</div>
<div className="flex items-center gap-2">
<select value={user.city_id || ''} onChange={e=>user.city_id = e.target.value} className="p-2 border rounded">
<option value="">— cidade —</option>
{cities.map(ct => <option key={ct.id} value={ct.id}>{ct.name}</option>)}
</select>
<label className="flex items-center gap-2"><input type="checkbox" checked={!!user.is_admin} onChange={e=>user.is_admin = e.target.checked} /> Admin</label>
<button onClick={()=>save(user)} className="px-3 py-1 rounded bg-brand-blue text-white">Salvar</button>
</div>
</div>
))}
</div>
</AdminLayout>
)
}